<!doctype! html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta charset="utf-8"/>
		<link rel="stylesheet" href="../static/css/app.css" type="text/css">
		<title>Lazarus</title>
		<link href="https://www.fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<script src="https://www.cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://www.unpkg.com/vue"></script><!-- 
			<script src="../static/css/materialize/js/materialize.js"></script>
			<link rel="stylesheet" href="../static/css/materialize/css/materialize.min.css"> -->
		<link rel="stylesheet" href="https://www.unpkg.com/leaflet@1.3.1/dist/leaflet.css"
		integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
		crossorigin=""/>
		 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://www.unpkg.com/leaflet@1.3.1/dist/leaflet.js"
 integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
 crossorigin=""></script>
 	<link rel="stylesheet" href="https://www.cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">

		
		<script src="https://www.cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
	</head>
	<body class="purple darken-4">
			<div class="row z-depth-5  white-text topmost">
					<h1 class="header center">The Lazarus Location Extractor</h1>
				</div>
		<div id="app">
			<div class="row">
				<div class="col s12 m6">
						<div class="crd z-depth-4 upld hoverable">
							<!-- 
								<form id="upload-form" method="post" enctype="multipart/form-data">
									<i class="material-icons">file_upload</i>
									<div class="form-content-container">
										<input id="upload_images" type="file" name="image" />
										<input id="upload_button" type="submit" value="Submit" />
									</div>
								</form>
								 -->
								 <div>
																			
									<form action="#">
											<div class="file-field input-field">
											<div class="center">
												<i class="material-icons " style="font-size:5em;">file_upload</i>
												<input type="file">
											</div>
											<div class="file-path-wrapper hide">
												<input class="file-path validate" type="text">
											</div>
											</div>
										</form>
										<p class="center" style="font-size:1.2em;">
											Here you upload the image of which location you want to find
										</p>
										</div>
								
						</div>
				</div>
				<div class="col s12 m6">
					<div class="crd">
						<div id="mapid"></div>
					</div>
				</div>
			</div>

			<div>
			
			</div>
			
			<div id="result">
<!--                <div class="item">-->
<!--                    <div>Input image</div>-->
<!--                    <img :src="input_image_url">-->
<!--                </div>-->
				<div class="item">
					<div>Result</div>
					<ul>
						<li>
							<img id="result-image" :src="result_image_url">
						</li>
					</ul>
				</div>
				<div class="item">
					<div>Runtime parameters</div>
					<div>
						<ul>
							<li v-for="(val, key) in rtparams">
							{% raw %}{{ key }}: {{ val }}{% endraw %}
							</li>
						</ul>
					</div>
				</div>
				<div class="item">
					<div>Timing</div>
					<div>
						<ul>
							<li v-for="(val, key) in timing">
							{% raw %}{{ key }}: {{ val }}{% endraw %}
							</li>
						</ul>
					</div>
				</div>
				<div class="item">
					<div>Text Lines</div>
					<div>
						<ul>
							<li> {% raw %}{{ text_lines.length }}{% endraw %} text lines </li>
							<li v-for="tl in text_lines">
							{% raw %}{{ tl }}{% endraw %}
							</li>
						</ul>
					</div>
				</div>

				<div class="item">
					<div>Host Info</div>
					<div>
						<ul>
							<li>
							<details>
								<summary>/proc/cpuinfo</summary>
								<pre>{% raw %}{{ cpuinfo }}{% endraw %}</pre>
							</details>
							</li>
							<li>
							<details>
								<summary>/proc/meminfo</summary>
								<pre>{% raw %}{{ meminfo }}{% endraw %}</pre>
							</details>
							<li>
							<details>
								<summary>/proc/loadavg</summary>
								<pre>{% raw %}{{ loadavg }}{% endraw %}</pre>
							</details>
							</li>
							</li>
						</ul>
					</div>
				</div>

				<div class="item">
					<div>JSON</div>
					<ul>
						<li>
						<a :href="result_json_url">{% raw %}{{ result_json_url }}{% endraw %}</a>
						</li>
					</ul>
				</div>

			</div>
			<hr>
			<footer>
				
			</footer>
		</div>

		<script>
			$(function() {
				function getQueryStrings() {
					var vars = [], hash, hashes;
					if (window.location.href.indexOf('#') === -1) {
						hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
					} else {
						hashes = window.location.href.slice(window.location.href.indexOf('?') + 1, window.location.href.indexOf('#')).split('&');
					}
					for(var i = 0; i < hashes.length; i++) {
						hash = hashes[i].split('=');
						vars.push(hash[0]);
						vars[hash[0]] = hash[1];
					}
					return vars;
				}

				var session_id = '{{session_id}}';

				var app = new Vue({
					el: '#app',
					data: {
						session_id: session_id,
						text_lines: [],
						rtparams: {},
						timing: {},
						cpuinfo: '',
						meminfo: '',
						loadavg: '',
					},
					computed: {
						input_image_url: function() { return '/static/results/' + this.session_id + '/input.png'; },
						result_image_url: function() { return '/static/results/' + this.session_id + '/output.png'; },
						result_json_url: function() { return '/static/results/' + this.session_id + '/result.json'; },
					},
				});

				var render = function(session_id) {
					app.session_id = session_id;
					app.text_lines = ['loading'];
					$.get('/static/results/' + session_id + '/result.json', function(data) {
						if (typeof data == 'string') {
							data = JSON.parse(data);
						}
						app.text_lines = data.text_lines;
						app.rtparams = data.rtparams;
						app.timing = data.timing;
						app.cpuinfo = data.cpuinfo
						app.meminfo = data.meminfo
						app.loadavg = data.loadavg
					});
				}

				if (session_id != 'dummy_session_id') {
					window.history.pushState({},"", '/?r=' + session_id);
					render(session_id);
				} else {
					var queryStrings = getQueryStrings();
					var rid = queryStrings['r'];
					if (rid) {
						render(rid);
					}
				}

			})

		</script>

	</body>
</html>
